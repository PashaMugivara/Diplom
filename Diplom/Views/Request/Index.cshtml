@model Diplom.Response.MissionAndRequestResponse

@{
    ViewBag.Title = "Все пользователи";
}
@if (User.IsInRole("user") || User.IsInRole("admin") || User.IsInRole("employee"))
{
    <a asp-action="Create">Создать запрос поддержки</a>
}
@if (User.IsInRole("admin"))
{
    <table class="table">

        <tr><td>Отправитель</td><td>Место запроса</td><td>Тип помощи</td><td>Статус</td></tr>
        @foreach (var item in Model.Requests)
        {
            <tr>
                <td>@item.User</td>
                <td>@item.Position</td>
                <td>@item.Type</td>
                <td>@item.State</td>
                <td>
                    @if (item.State == "Новый")
                    {
                    <form asp-controller="Mission" asp-action="Index" asp-route-id="@item.Id" method="post">
                        <button type="submit" class="btn btn-sm btn-dark">
                            Назначить сотрудника
                        </button>
                    </form>
                    }
                </td>
            </tr>
        }
    </table>
}
@if (User.IsInRole("employee"))
{
    <table class="table">

        <tr><td>Отправитель</td><td>Место запроса</td><td>Тип помощи</td><td>Статус</td></tr>
        @foreach (var item in Model.Missions)
        {
            <tr>
                <td>@item.User</td>
                <td>@item.Position</td>
                <td>@item.Type</td>
                <td>@item.State</td>
                <td>
                    @if (item.State == "Новый")
                    {
                        <form asp-controller="Request" asp-action="Update" asp-route-Id="@item.Id" method="post">
                            <button type="submit" class="btn btn-sm btn-dark">
                                Принять
                            </button>
                        </form>
                    }
                    @if (item.State == "В процессе")
                    {
                        <form asp-controller="Request" asp-action="Update" asp-route-Id="@item.Id" method="post">
                            <button type="submit" class="btn btn-sm btn-dark">
                                Завершить
                            </button>
                        </form>
                    }
                </td>
            </tr>
        }
    </table>
}